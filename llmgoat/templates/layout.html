<!DOCTYPE html>
<html lang="{{ lang | default('en') }}">
<head>
    <title>LLMGoat - OWASP Top 10 for LLMs</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='icons/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
        <a href="/" class="logo-link">
            <img src="{{ url_for('static', filename='images/Logo.svg') }}" alt="LLMGoat" class="logo">
        </a>
    </div>
    <nav class="sidebar-nav">
        <h2>{{ translations.owasp_top_10 | default('OWASP Top 10') }}</h2>
        <ul>
            {% for item in challenges %}
                <li id="challenge-{{ item.id }}"
                    class="
                        {% if item.id == current_challenge %} current {% endif %}
                        {% if item.id in completed_challenges %} completed {% endif %}
                ">
                    <a href="/challenges/{{ item.id }}">
                        <span class="icon"></span>
                        <span class="title">{{ item.title }}</span>
                    </a>
                 </li>
            {% endfor %}
        </ul>

        <form id="model-select-form" class="model-box">
            <div class="model-inner-box">
                <h3 class="model-title">{{ translations.select_model | default('Select Model') }}</h3>
                <select name="model_name" id="model-select">
                    {% for model in models %}
                        <option value="{{ model }}" {% if model == selected_model %}selected{% endif %}>
                            {{ model }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </form>

        <div class="language-box">
            <div class="model-inner-box">
                <h3 class="model-title">{{ translations.language | default('Language') }}</h3>
                <select id="language-select">
                    {% for supported_lang in supported_languages | default(['en', 'ko']) %}
                        <option value="{{ supported_lang }}" {% if supported_lang == lang %}selected{% endif %}>
                            {% if supported_lang == 'en' %}English{% elif supported_lang == 'ko' %}한국어{% else %}{{ supported_lang }}{% endif %}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </nav>
  </div>
    
  <div class="main-content-wrapper">
    <main class="main-content">
        {% include content_template %}
    </main>
        
    <footer class="main-footer">
        LLMGOAT by <a href="https://www.secforce.com/" target="_blank">SECFORCE</a>
    </footer>
  </div>

  <script type="module">
    import { initModelStatus, initModelSelector } from "/static/js/main.js";

    initModelStatus()
    initModelSelector();

    // 언어 선택 핸들러
    const langSelect = document.getElementById("language-select");
    if (langSelect) {
      langSelect.addEventListener("change", async function(e) {
        const selectedLang = e.target.value;
        try {
          const res = await fetch("/api/set_language", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ language: selectedLang }),
          });
          if (res.ok) {
            window.location.reload();
          }
        } catch (err) {
          console.error("Failed to change language", err);
        }
      });
    }
  </script>

</body>
</html>
